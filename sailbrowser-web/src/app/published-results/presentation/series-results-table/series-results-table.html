<table cdk-table class="table" [dataSource]="tableData()" [trackBy]="trackByKey" [style.font-size]="fontSize()">

   <!-- Initial columns -->
   <ng-container cdkColumnDef="rank" sticky>
      <th cdk-header-cell class="rank-col" *cdkHeaderCellDef>Rank</th>
      <td cdk-cell *cdkCellDef="let competitor">
         <div class="rank-oval" [class.rank-1]="competitor.rank === 1" [class.rank-2]="competitor.rank === 2"
            [class.rank-3]="competitor.rank === 3">
            {{competitor.rank}}
         </div>
      </td>
   </ng-container>

   <ng-container cdkColumnDef="name" sticky>
      <th cdk-header-cell class="name-col" *cdkHeaderCellDef>Helm/Crew</th>
      <td cdk-cell *cdkCellDef="let competitor">
         {{competitor.name}}
      </td>
   </ng-container>

   <ng-container cdkColumnDef="boatClass">
      <th cdk-header-cell *cdkHeaderCellDef>Class</th>
      <td cdk-cell *cdkCellDef="let competitor"> {{ competitor.boatClass }} </td>
   </ng-container>

   <ng-container cdkColumnDef="sailNumber">
      <th cdk-header-cell *cdkHeaderCellDef>Sail No</th>
      <td cdk-cell *cdkCellDef="let competitor"> {{ competitor.sailNumber }} </td>
   </ng-container>

   <ng-container cdkColumnDef="club">
      <th cdk-header-cell *cdkHeaderCellDef>Club</th>
      <td cdk-cell *cdkCellDef="let competitor"> {{ competitor.club }} </td>
   </ng-container>

   <ng-container cdkColumnDef="handicap">
      <th cdk-header-cell *cdkHeaderCellDef>Handicap</th>
      <td cdk-cell *cdkCellDef="let competitor"> {{ competitor.handicap }} </td>
   </ng-container>

   <ng-container cdkColumnDef="totalPoints">
      <th cdk-header-cell class="points-col" *cdkHeaderCellDef>Total</th>
      <td cdk-cell *cdkCellDef="let competitor"> {{ competitor.totalPoints }} </td>
   </ng-container>

   <ng-container cdkColumnDef="netPoints">
      <th cdk-header-cell class="points-col" *cdkHeaderCellDef>Net</th>
      <td cdk-cell *cdkCellDef="let competitor"> {{ competitor.netPoints }} </td>
   </ng-container>

   <!-- Splits times columns -->
   @for (raceCol of raceColumns(); track raceCol; let i = $index) {
   <ng-container [cdkColumnDef]="raceCol">
      <th cdk-header-cell class="race-col" *cdkHeaderCellDef (click)="onRaceHeaderClick(i)">
         <div [innerHTML]="raceTitle(i)"></div>
      </th>
      <td cdk-cell *cdkCellDef="let comp">
         @if (comp.raceScores[i]; as score) {
         <span [class.discarded]="score.isDiscard" [class.fastest]="score.position === 1"
            [class.second]="score.position === 2" [class.third]="score.position === 3">
            {{ score.isDiscard ? '(' : '' }}{{ score.points }}{{ score.resultCode !== 'OK' ? ' ' + score.resultCode : ''
            }}{{ score.isDiscard ? ')' : '' }}
         </span>
         }
      </td>
   </ng-container>
   }

   <tr cdk-header-row class="header" *cdkHeaderRowDef="displayedColumns(); sticky: true"></tr>
   <tr cdk-row class="row" *cdkRowDef="let competitor; columns: displayedColumns(); let even = $even"
      [class.even-row]="even" [class.selected]="isCompetitorSelected(competitor)">
   </tr>
</table>